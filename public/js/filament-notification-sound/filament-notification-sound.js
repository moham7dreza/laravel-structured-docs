document.addEventListener("livewire:initialized",()=>{const d={soundPath:"/sounds/notification.mp3",showAnimation:!0,volume:1,selectors:[],timeouts:{pollDelay:50,animationDuration:1e3,tooltipShowDuration:3e3,tooltipFadeDuration:300,titleFlashInterval:1e3}},m=window.filamentNotificationSoundConfig||{},e={...d,...m,volume:Math.max(0,Math.min(1,m.volume??d.volume)),timeouts:{...d.timeouts,...m.timeouts||{}}};Object.keys(e.timeouts).forEach(o=>{(typeof e.timeouts[o]!="number"||e.timeouts[o]<0)&&(console.warn(`Invalid timeout for ${o}, using default value`),e.timeouts[o]=d.timeouts[o])});let f=0;const i=new Audio(e.soundPath);i.volume=e.volume;let p=!1;const a=()=>{p||i.play().then(()=>{i.pause(),i.currentTime=0,p=!0,h()}).catch(o=>{console.warn("Failed to unlock audio:",o)})},h=()=>{document.removeEventListener("click",a),document.removeEventListener("keydown",a),document.removeEventListener("touchstart",a)};document.addEventListener("click",a),document.addEventListener("keydown",a),document.addEventListener("touchstart",a);const w=()=>{const o=[".fi-topbar-database-notifications-btn .fi-badge span",".fi-topbar-database-notifications-btn .fi-badge",".fi-icon-btn-badge-ctn .fi-badge",'[x-ref="notifications-trigger"] span'];for(const r of o){const l=document.querySelector(r);if(l){const s=parseInt(l.innerText);if(!isNaN(s))return s}}return 0};f=w(),window.Livewire&&typeof window.Livewire.hook=="function"&&window.Livewire.hook("effect",({component:o})=>{setTimeout(()=>{const r=w();if(r>f){if(i.currentTime=0,i.play().catch(v=>{console.warn("Failed to play notification sound:",v)}),e.showAnimation){const v=[".fi-topbar-database-notifications-btn",".fi-icon-btn-badge-ctn",'[x-ref="notifications-trigger"]'];let n=null;for(const t of v){const u=document.querySelector(t);if(u){n=u;break}}if(n){n.classList.add("notification-pulse"),setTimeout(()=>{n.classList.remove("notification-pulse")},e.timeouts.animationDuration);let t=n.querySelector(".notification-tooltip");t||(t=document.createElement("div"),t.className="notification-tooltip",t.innerText="New Notification!",window.getComputedStyle(n).position==="static"&&(n.style.position="relative"),n.appendChild(t)),t.offsetWidth,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{try{t&&t.parentNode&&t.parentNode.contains(t)&&t.parentNode.removeChild(t)}catch(u){console.warn("Failed to remove tooltip:",u)}},e.timeouts.tooltipFadeDuration)},e.timeouts.tooltipShowDuration)}}const l=document.title;let s=!1;const L=setInterval(()=>{document.title=s?l:`ðŸ”” ${r} New Notifications!`,s=!s},e.timeouts.titleFlashInterval),c=()=>{clearInterval(L),document.title=l,document.removeEventListener("click",c),document.removeEventListener("keydown",c),document.removeEventListener("touchstart",c)};document.addEventListener("click",c),document.addEventListener("keydown",c),document.addEventListener("touchstart",c)}f=r},e.timeouts.pollDelay)})});
